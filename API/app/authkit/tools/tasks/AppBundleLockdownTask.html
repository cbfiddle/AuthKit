<!-- Automatically generated with polardoc Version 1.0.7 on Sun Aug 10 12:16:12 MST 2003 --><!-- app.authkit.tools.tasks.AppBundleLockdownTask | Do not remove or edit this line! --><HTML><HEAD><TITLE>  Class app.authkit.tools.tasks.AppBundleLockdownTask</TITLE></HEAD><BODY BGCOLOR="#FFFFFF" LINK="#0000FF" VLINK="#0000FF" ALINK="#0000FF"><A NAME="_top_"></A><PRE><A HREF="../../../../packages.html">All Packages</A>  <A HREF="../../../../Package-app/authkit/tools/tasks.html">This Package</A>  <A HREF="../../../../tree.html">Class Hierarchy</A>  <A HREF="../../../../Search.html">Class Search</A>  <A HREF="../../../../AllNames.html">Index</A></PRE><HR SIZE=1 ALIGN=left WIDTH="98%"><B><FONT FACE="Arial,Helvetica" SIZE=+2>     Class app.authkit.tools.tasks.AppBundleLockdownTask</FONT></B><PRE>java.lang.Object   |   +----<A HREF="../../../../app/authkit/tools/tasks/CommonTask.html">app.authkit.tools.tasks.CommonTask</A>           |           +----app.authkit.tools.tasks.AppBundleLockdownTask</PRE><P><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Summary</B></FONT></TD> </TR> </TABLE><A NAME="_Summary_"></A><PRE>public class  <STRONG>AppBundleLockdownTask</STRONG>     extends app.authkit.tools.tasks.<A HREF="../../../../app/authkit/tools/tasks/CommonTask.html">CommonTask</A>{          // Constructors 1     public <A HREF="#AppBundleLockdownTask()">AppBundleLockdownTask</A>();          // Methods 1     public int <A HREF="#perform(java.lang.String[], glguerin.authkit.Authorization)">perform</A>(String[], Authorization);}</PRE><P><DL><P>AppBundleLockdownTask is a Task that locks down app-bundles. It is perform()'ed by a privileged Envoy process, launched by AppBundleLockdown.<p> When traversing the app-bundle, symlinks are not followed, nor are alias-files resolved. The app-bundle pathname may be a symlink, and it WILL be followed.<p> Everything in the app-bundle has its setuid and all write-permissions removed. All other permissions (setgid, sticky, read, and execute/search) are unchanged. In effect, the POSIX permissions of each file and directory are AND'ed with 03555 (octal).<p> Everything in the app-bundle has its owner changed to 'root'. The group is not changed on any file or directory.<p> The setuid bits are removed to eliminate the possibility of a program gaining elevated privileges simply by having its setuid bit set before changing ownership to 'root', and then becoming setuid-root as a consequence of the ownership change.<p> The setgid bit is not changed.  This poses no added security risk, because the group is not changed. So even if a Trojan-horse file with setgid set was present, there would be no unexpected setgid consequences since there is no change.<p> The commands executed by this Task are platform-specific to Mac OS X. Other Unix-like platforms will have similar commands, but their location and options may differ. I have no idea if Windows has similar commands, nor what they might be.<p> The shell-equivalents of the commands executed are:<pre>	/usr/bin/find -Pdx $ARG -name '.*DS_Store' -type f -exec /bin/rm '{}' ';'	/bin/chmod -RP u-s,a-w $ARG	/usr/sbin/chown -RP root $ARG</pre> Each $ARG is replaced by the pathname of the target app-bundle. The 'find' primary "-delete" isn't used because it's only available on 10.2+. Absolute command pathnames are used to preclude PATH spoofing.<h3>System Properties Used</h3><dl>  <dt>"envoy.keep.DS_Store"  (boolean, default false)</dt>  <dd>    should all '.*DS_Store' files in app-bundle be kept (T) or deleted (F)?  </dd></dl><P></DL><P><BR><BR><BR><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Constructors</B></FONT></TD> </TR> </TABLE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="AppBundleLockdownTask"><FONT COLOR="#FFCC00">&middot;</FONT></A><A NAME="AppBundleLockdownTask()">AppBundleLockdownTask</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public AppBundleLockdownTask() </PRE><BLOCKQUOTE><DL><P>Default constructor<P></DL></BLOCKQUOTE> <BR><BR><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Methods</B></FONT></TD> </TR> </TABLE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="perform"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="perform(java.lang.String[], glguerin.authkit.Authorization)">perform</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public int perform(String[] args,                       <A HREF="../../../../glguerin/authkit/Authorization.html">Authorization</A> auth) </PRE><BLOCKQUOTE><DL><P>Perform the actions embodied in this Task, returning a completion-code, which an Envoy then returns to its master.<p> A value of zero means "success".  Non-zero values mean some kind of failure. If this method throws any exceptions, that is also considered a failure.<p> This method enforces the underlying Authorization policy rules by calling authorize() before anything is done.  The Privilege is a root-execute Privilege created by makeExecPrivilege(), without a command-name.  We could authorize() each command before exec()'ing it, but that seems a little too much.<p> If this Task was doing something that should have its own named Privilege, then we'd use that application-specific named Privilege.  Since there isn't a specific Privilege, other than the general root-exec one, that's what we authorize().<p> The authorize() call is not permitted user-interaction, because this code should not be running interactively.  Either we already have the Privilege granted, or it's implied by the effective-uid of root, but we do not allow user authentication now. If it fails, it fails, and the Envoy will terminate appropriately.<p> This use of authorize() is the typical approach to guarding a restricted section of code. Do not omit it just because you think it's safe to assume it's running as root. Good security means not making assumptions.<P><DT><B>Implements:</B><DD><A HREF="../../../../app/authkit/envoy/Task.html#perform(java.lang.String[], glguerin.authkit.Authorization)">perform</A> in interface <A HREF="../../../../app/authkit/envoy/Task.html">Task</A></DL></BLOCKQUOTE> <BR><HR SIZE=1 ALIGN=left WIDTH="98%"><PRE><A HREF="../../../../packages.html">All Packages</A>  <A HREF="../../../../Package-app/authkit/tools/tasks.html">This Package</A>  <A HREF="../../../../tree.html">Class Hierarchy</A>  <A HREF="../../../../Search.html">Class Search</A>  <A HREF="../../../../AllNames.html">Index</A></PRE><FONT FACE="Arial,Helvetica" SIZE=-2>Freshly brewed Java API Documentation automatically generated with <A HREF="http://www.ualberta.ca/~tgee/polardoc">polardoc</A> Version 1.0.7<BR></FONT></BODY></HTML>
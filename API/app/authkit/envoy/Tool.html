<!-- Automatically generated with polardoc Version 1.0.7 on Sun Aug 10 12:16:12 MST 2003 --><!-- app.authkit.envoy.Tool | Do not remove or edit this line! --><HTML><HEAD><TITLE>  Class app.authkit.envoy.Tool</TITLE></HEAD><BODY BGCOLOR="#FFFFFF" LINK="#0000FF" VLINK="#0000FF" ALINK="#0000FF"><A NAME="_top_"></A><PRE><A HREF="../../../packages.html">All Packages</A>  <A HREF="../../../Package-app/authkit/envoy.html">This Package</A>  <A HREF="../../../tree.html">Class Hierarchy</A>  <A HREF="../../../Search.html">Class Search</A>  <A HREF="../../../AllNames.html">Index</A></PRE><HR SIZE=1 ALIGN=left WIDTH="98%"><B><FONT FACE="Arial,Helvetica" SIZE=+2>     Class app.authkit.envoy.Tool</FONT></B><PRE>java.lang.Object   |   +----app.authkit.envoy.Tool</PRE><P><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Summary</B></FONT></TD> </TR> </TABLE><A NAME="_Summary_"></A><PRE>public abstract class  <STRONG>Tool</STRONG>     extends java.lang.Object{          // Constructors 1     protected <A HREF="#Tool()">Tool</A>();          // Methods 24     protected void <A HREF="#addEnvoyTask(java.util.Vector, java.lang.String, java.lang.String[])">addEnvoyTask</A>(Vector, String, String[]);     protected void <A HREF="#addJavaCommand(java.util.Vector, java.lang.String, java.lang.String[])">addJavaCommand</A>(Vector, String, String[]);     protected void <A HREF="#addOneProperty(java.util.Vector, java.lang.String)">addOneProperty</A>(Vector, String);     protected void <A HREF="#addPrefixedProperties(java.util.Vector, java.lang.String)">addPrefixedProperties</A>(Vector, String);     protected void <A HREF="#alert(java.lang.String, java.lang.Object[])">alert</A>(String, Object[]);     protected byte[] <A HREF="#captureUntilEOF(java.io.InputStream, java.io.OutputStream, int)">captureUntilEOF</A>(InputStream, OutputStream, int) throws IOException;     protected String[] <A HREF="#chooseTarget(java.lang.String, int)">chooseTarget</A>(String, int);     public void <A HREF="#depart(int)">depart</A>(int);     public void <A HREF="#explain(java.lang.String)">explain</A>(String);     public void <A HREF="#explain(java.lang.Throwable)">explain</A>(Throwable);     protected void <A HREF="#failed(java.lang.Throwable, boolean, java.lang.String)">failed</A>(Throwable, boolean, String);     protected Object[] <A HREF="#getEnvoyMessageParts(java.lang.String, int, java.lang.String)">getEnvoyMessageParts</A>(String, int, String);     protected String <A HREF="#getJavaPath(java.lang.String)">getJavaPath</A>(String);     protected String[] <A HREF="#makeEnvoyCommand(java.lang.String, java.lang.String[], java.lang.String, java.lang.String, java.lang.String, java.lang.String[])">makeEnvoyCommand</A>(String, String[], String, String, String, String[]);     public String <A HREF="#mustBeAppBundle(java.lang.String)">mustBeAppBundle</A>(String) throws IOException;     protected Authorization <A HREF="#newAuth()">newAuth</A>();     protected Frame <A HREF="#nonceFrame()">nonceFrame</A>();     public abstract void <A HREF="#perform(java.lang.String[])">perform</A>(String[]);     protected void <A HREF="#presupposeProperty(java.lang.String, java.lang.String)">presupposeProperty</A>(String, String);     protected long <A HREF="#schlepUntilEOF(java.io.InputStream, java.io.OutputStream)">schlepUntilEOF</A>(InputStream, OutputStream) throws IOException;     protected String[] <A HREF="#stripPrefixed(java.lang.String[], java.lang.String)">stripPrefixed</A>(String[], String);     public void <A HREF="#tell(java.lang.String)">tell</A>(String);     protected String <A HREF="#translateEnvoyMessage(byte[])">translateEnvoyMessage</A>(byte[]);     protected int <A HREF="#waitForEnvoy(java.io.InputStream, java.io.OutputStream)">waitForEnvoy</A>(InputStream, OutputStream) throws IOException;}</PRE><P><DL><P>A Tool is a class that runs a privileged Envoy process and presents the results. It encapsulates the unprivileged side of peforming privileged Tasks using an Authorization.<p> Typically, a concrete Tool subclass is given a purpose-specific perform() method along with a completely generalized main() method that calls perform(). But this is only typical, not required. You don't have to give your Tool class a main() method. You don't have to give it a meaningful perform() method. You don't even have to use a Tool class at all to run a privileged Envoy process. It's just a convenient way to do so.<p> A Tool may represent only a command-line program, only a GUI program, or both, or neither.  Some Tool methods refer to AWT classes, but you don't have to use them if you don't want to.  If you want to use Swing classes, or some other GUI's classes, you can do that.<p> Most Tool methods are utility or support methods for doing the things a Tool should do on behalf of an Envoy process:<ul>  <li>creating a concrete Authorization</li>  <li>preauthorizing the user, as appropriate</li>  <li>selecting a target item interactively, as appropriate</li>  <li>building a complete 'java' command-line to run an Envoy process</li>  <li>reading and parsing Envoy-protocol results</li>  <li>presenting alerts, as appropriate</li></ul><h3>System Properties Used</h3><dl>  <dt>"file.encoding"</dt>  <dd>in <b>addJavaCommand()</b>    as a predefined property when building the Envoy process's command-line.    Also implicitly used anywhere a PrintStream is created or parsed,    such as captureUntilEOF(), schlepUntilEOF(), or waitForEnvoy();    or anywhere encoded bytes are turned into a String,    such as translateEnvoyMessage().  </dd>  <dt>"java.class.path"</dt>  <dd>in <b>addJavaCommand()</b>    as the "-cp" parameter when building a 'java' command-line.  </dd>  <dt>"java.home"</dt>  <dd>in <b>getJavaPath()</b>    to determine where javaCommand is located, to construct an absolute pathname.  </dd>  <dt>"os.name"</dt>  <dd>in <b>newAuth()</b>    to determine which Authorization class to instantiate.  </dd>  <dt>"envoy.tasks.between"</dt>  <dd>a string value, in <b>addEnvoyTask()</b>    to precede the task-name when building an Envoy-process command-line.  </dd>  <dt>"alert"</dt>  <dd>a boolean value, in <b>alert()</b>    to decide whether to present a BasicAlert or to do nothing.    If alert() isn't called, this property has no effect.  </dd>  <dt>"no-exit"</dt>  <dd>a boolean value, in <b>depart()</b>    to decide whether to call System.exit() or throw a ThreadDeath.    If depart() isn't called, this property has no effect.  </dd></dl><P></DL><P> <B>See Also:</B><A HREF="../../../app/authkit/envoy/Envoy.html">Envoy</A><P><BR><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Cross Reference</B></FONT></TD> </TR> </TABLE><BR><DL><DT><B>Extended By: </B><DD><A HREF="../../../app/authkit/tools/AppBundleLockdown.html">AppBundleLockdown</A>, <A HREF="../../../app/authkit/tools/PerformAsRoot.html">PerformAsRoot</A><P></DL><BR><BR><BR><BR><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Constructors</B></FONT></TD> </TR> </TABLE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="Tool"><FONT COLOR="#FFCC00">&middot;</FONT></A><A NAME="Tool()">Tool</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected Tool() </PRE><BLOCKQUOTE><DL><P>Accessible only to subclasses.<P></DL></BLOCKQUOTE> <BR><BR><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Methods</B></FONT></TD> </TR> </TABLE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="tell"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="tell(java.lang.String)">tell</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public void tell(String toTell) </PRE><BLOCKQUOTE><DL><P>Emit line of text on stdout.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="explain"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="explain(java.lang.String)">explain</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public void explain(String text) </PRE><BLOCKQUOTE><DL><P>Emit line of text on stderr, flushing stdout first.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="explain"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="explain(java.lang.Throwable)">explain</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public void explain(Throwable toExplain) </PRE><BLOCKQUOTE><DL><P>Emit stack trace on stderr, flushing stdout first.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="perform"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="perform(java.lang.String[])">perform</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public abstract void perform(String[] args) </PRE><BLOCKQUOTE><DL><P>Perform this Tool's actions on the given args. Typically called by a concrete Tool's main() method:<pre>		public static void 		main( String[] args ) 		{  new ToolSubclass().perform( args );  }</pre><P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="depart"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="depart(int)">depart</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public void depart(int status) </PRE><BLOCKQUOTE><DL><P>Calls exit() or throws ThreadDeath, depending on "no-exit" property.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="presupposeProperty"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="presupposeProperty(java.lang.String, java.lang.String)">presupposeProperty</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void presupposeProperty(String propName,                                      String propValue) </PRE><BLOCKQUOTE><DL><P>If the system property named by propName is already defined, do nothing. Otherwise, define it to have the non-null propValue.<p> This is useful when interaction, such as a FileDialog, presupposes subsequent interaction is desirable, such as controlled by the "alert" property.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="newAuth"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="newAuth()">newAuth</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected <A HREF="../../../glguerin/authkit/Authorization.html">Authorization</A> newAuth() </PRE><BLOCKQUOTE><DL><P>The returned Authorization is unattached to any underlying session. The available concrete imps are hard-wired here, for security reasons.<p> If the "os.name" property is "Mac OS X", then a MacOSXAuthorization is returned. All other situations, including failure to instantiate a MacOSXAuthorization, return a DenyAllAuthorization.<p> The concrete classes are referenced by name, using Class.forName(). This avoids invoking an imp's static initializers unless it's actually chosen.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="stripPrefixed"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="stripPrefixed(java.lang.String[], java.lang.String)">stripPrefixed</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected String[] stripPrefixed(String[] array,                                     String prefix) </PRE><BLOCKQUOTE><DL><P>Strip nulls and Strings that start with prefix, returning a String[]. If no Strings start with prefix, the original array is returned. Useful in other cases, but mainly for stripping "-psn_*" from args.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="nonceFrame"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="nonceFrame()">nonceFrame</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected Frame nonceFrame() </PRE><BLOCKQUOTE><DL><P>Create a new nonce Frame that isn't intended to be shown, but is only needed as an anchor for a Component or Dialog hierarchy. Called by chooseTarget() and alert().<P></DL><P> <B>See Also:</B><A HREF="#chooseTarget">chooseTarget</A>, <A HREF="#alert">alert</A></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="chooseTarget"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="chooseTarget(java.lang.String, int)">chooseTarget</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected String[] chooseTarget(String prompt,                                    int kind) </PRE><BLOCKQUOTE><DL><P>Choose a target to operate on by presenting a FileDialog. The prompt and kind determine the FileDialog displayed. The resulting selection is returned as a String[], or null if cancelled.<P></DL><P> <B>See Also:</B><A HREF="../../../app/util/FileDialogger.html">FileDialogger</A></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="mustBeAppBundle"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="mustBeAppBundle(java.lang.String)">mustBeAppBundle</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public String mustBeAppBundle(String filename)  throws IOException</PRE><BLOCKQUOTE><DL><P>If an app-bundle, return canonical absolute pathname with symlinks resolved. If not an app-bundle, throw an IOException whose message summarizes why.<p> This implementation requires the following for success:<ol>  <li>the target must exist and be accessible</li>  <li>the target must be a directory</li>  <li>there must be a file "Contents/PkgInfo" nested inside the target directory</li>  <li>the PkgInfo file must be readable and at least 8 bytes long</li>  <li>the PkgInfo file must contain 'APPL' as its first 4 bytes.</li>  <li>the target directory must be resolveable by getCanonicalPath()</li></ol><P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="makeEnvoyCommand"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="makeEnvoyCommand(java.lang.String, java.lang.String[], java.lang.String, java.lang.String, java.lang.String, java.lang.String[])">makeEnvoyCommand</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected String[] makeEnvoyCommand(String javaCmd,                                        String[] jvmArgs,                                        String envoyClass,                                        String envoyPrefix,                                        String taskName,                                        String[] taskArgs) </PRE><BLOCKQUOTE><DL><P>Build a complete command-line to run envoyClass.main() in another process.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="getJavaPath"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="getJavaPath(java.lang.String)">getJavaPath</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected String getJavaPath(String javaCommand) </PRE><BLOCKQUOTE><DL><P>Make an absolute pathname representing a Java interpreter command. It is formed by taking the "java.home" property's value and appending the supplied String with a File.separator between them. If the given String is empty or null, append "bin/java", using appropriate File.separator.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="addJavaCommand"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="addJavaCommand(java.util.Vector, java.lang.String, java.lang.String[])">addJavaCommand</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void addJavaCommand(Vector command,                                  String javaCommand,                                  String[] jvmArgs) </PRE><BLOCKQUOTE><DL><P>Start building a 'java' command-line. On return, the Vector contains the command itself, the classpath designation (inherited from self), a "-Dfile.encoding=xxx" so the new process will share this process's default text-encoding, and all the non-null values in jvmArgs.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="addPrefixedProperties"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="addPrefixedProperties(java.util.Vector, java.lang.String)">addPrefixedProperties</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void addPrefixedProperties(Vector command,                                         String propPrefix) </PRE><BLOCKQUOTE><DL><P>System properties starting with propPrefix are -D'ed onto Vector. A null propPrefix adds no properties. An empty propPrefix adds them all.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="addOneProperty"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="addOneProperty(java.util.Vector, java.lang.String)">addOneProperty</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void addOneProperty(Vector command,                                  String propName) </PRE><BLOCKQUOTE><DL><P>If property's value is non-null, add a "-Dxx=yy" to the Vector.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="addEnvoyTask"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="addEnvoyTask(java.util.Vector, java.lang.String, java.lang.String[])">addEnvoyTask</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void addEnvoyTask(Vector cmd,                                String taskName,                                String[] taskArgs) </PRE><BLOCKQUOTE><DL><P>Add inter-Task marker, taskName, and taskArgs to cmd Vector. Uses the "envoy.tasks.between" property as the inter-Task marker, or Envoy.TASKS_BETWEEN as the marker's default.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="captureUntilEOF"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="captureUntilEOF(java.io.InputStream, java.io.OutputStream, int)">captureUntilEOF</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected byte[] captureUntilEOF(InputStream in,                                     OutputStream out,                                     int captureSize)  throws IOException</PRE><BLOCKQUOTE><DL><P>Wait for EOF on InputStream, schlepping everything received to OutputStream and capturing the last captureSize bytes to be returned. Neither stream is closed. Calls schlepUntilEOF().<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="schlepUntilEOF"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="schlepUntilEOF(java.io.InputStream, java.io.OutputStream)">schlepUntilEOF</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected long schlepUntilEOF(InputStream in,                                  OutputStream out)  throws IOException</PRE><BLOCKQUOTE><DL><P>Wait for EOF on InputStream, schlepping everything received to OutputStream, using the current Thread rather than an asynchronous daemon Thread. The number of bytes transferred is returned. Neither stream is closed.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="translateEnvoyMessage"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="translateEnvoyMessage(byte[])">translateEnvoyMessage</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected String translateEnvoyMessage(byte[] bytes) </PRE><BLOCKQUOTE><DL><P>Translate a portion of an Envoy-protocol communication into String form. The portion is typically a captured section, so its bytes may not encode complete characters, if it is in a multi-byte encoding.  For safety, though at some loss of robustness, this method first translates all bytes in the range 0x80-0xFF into ?'s as substitutes. That is, all negative bytes are transformed into single-byte characters.<p> The given byte[] is modified before being turned into a String. The byte[] is encoded using the default encoding (i.e. "file.encoding").<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="getEnvoyMessageParts"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="getEnvoyMessageParts(java.lang.String, int, java.lang.String)">getEnvoyMessageParts</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected Object[] getEnvoyMessageParts(String text,                                            int index,                                            String marker) </PRE><BLOCKQUOTE><DL><P>Extract an Envoy message identified by marker, from the text starting at index. The message begins at the first appearance of the marker, and ends at the first following appearance of Envoy.PROTOCOL_NEWLINE. The message is then separated into parts by Envoy.PROTOCOL_DELIM, which are returned as an Object[] containing String and Integer values.<p> The index tells where to start scanning the text for the marker, and in which direction. Non-negative values count from the start of the text and scan towards the end. Negative index values count from past the end of the text and scan towards the start. So -1 means the last char, -2 the next to last, etc. The Envoy.PROTOCOL_NEWLINE always follows the marker, so it is always searched for by scanning towards the end of the text.<p> Returns an array containing mixed String and/or Integer values. Any piece that can be converted to an Integer is returned as an Integer. Any piece that can't be converted to an Integer is returned as a String.<p> <B> This method uses Envoy's protocol strings, and relies on knowledge of their format. If the Envoy protocol is changed, this method must also change. </B><P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="waitForEnvoy"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="waitForEnvoy(java.io.InputStream, java.io.OutputStream)">waitForEnvoy</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected int waitForEnvoy(InputStream in,                               OutputStream out)  throws IOException</PRE><BLOCKQUOTE><DL><P>Wait for an Envoy-protocol 'stop' message on InputStream, echoing the data to the OutputStream, and parsing the Envoy's final status from the data.<p> If the OutputStream is null, the Envoy protocol stream is parsed for an Envoy STOP message, but otherwise consumed.<p> Parsing failures throw an IOException whose message summarizes the reason for failure. <B> This method relies on knowledge of Envoy's protocol format, The PROTOCOL_STOP message in particular. If the Envoy protocol is changed, this method must also change. </B><P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="failed"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="failed(java.lang.Throwable, boolean, java.lang.String)">failed</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void failed(Throwable why,                          boolean stackTrace,                          String alertTitle) </PRE><BLOCKQUOTE><DL><P>Emit to stderr, then call alert().<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="alert"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="alert(java.lang.String, java.lang.Object[])">alert</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void alert(String alertTitle,                         Object[] alertLines) </PRE><BLOCKQUOTE><DL><P>Show a modal BasicAlert if "alert" property is true, or do nothing if it's false. The BasicAlert has a 5- to 12-line by 50-char text-area, with no scrollbars or only a vertical one. The alertText will be added as lines, one for each Object.toString(). If a String contains newlines, those will be additional lines. The supplied alertText lines will be wrapped to fit, though not necessarily word-wrapped.<p> If you need a more flexible BasicAlert, make your own or define an override.<P></DL></BLOCKQUOTE> <BR><HR SIZE=1 ALIGN=left WIDTH="98%"><PRE><A HREF="../../../packages.html">All Packages</A>  <A HREF="../../../Package-app/authkit/envoy.html">This Package</A>  <A HREF="../../../tree.html">Class Hierarchy</A>  <A HREF="../../../Search.html">Class Search</A>  <A HREF="../../../AllNames.html">Index</A></PRE><FONT FACE="Arial,Helvetica" SIZE=-2>Freshly brewed Java API Documentation automatically generated with <A HREF="http://www.ualberta.ca/~tgee/polardoc">polardoc</A> Version 1.0.7<BR></FONT></BODY></HTML>
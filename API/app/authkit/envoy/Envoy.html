<!-- Automatically generated with polardoc Version 1.0.7 on Sun Aug 10 12:16:12 MST 2003 --><!-- app.authkit.envoy.Envoy | Do not remove or edit this line! --><HTML><HEAD><TITLE>  Class app.authkit.envoy.Envoy</TITLE></HEAD><BODY BGCOLOR="#FFFFFF" LINK="#0000FF" VLINK="#0000FF" ALINK="#0000FF"><A NAME="_top_"></A><PRE><A HREF="../../../packages.html">All Packages</A>  <A HREF="../../../Package-app/authkit/envoy.html">This Package</A>  <A HREF="../../../tree.html">Class Hierarchy</A>  <A HREF="../../../Search.html">Class Search</A>  <A HREF="../../../AllNames.html">Index</A></PRE><HR SIZE=1 ALIGN=left WIDTH="98%"><B><FONT FACE="Arial,Helvetica" SIZE=+2>     Class app.authkit.envoy.Envoy</FONT></B><PRE>java.lang.Object   |   +----app.authkit.envoy.Envoy</PRE><P><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Summary</B></FONT></TD> </TR> </TABLE><A NAME="_Summary_"></A><PRE>public class  <STRONG>Envoy</STRONG>     extends java.lang.Object{          // Fields 11     public static final String <A HREF="#PROTOCOL_BEGIN_OUTPUT">PROTOCOL_BEGIN_OUTPUT</A>;     public static final String <A HREF="#PROTOCOL_BEGIN_TASK">PROTOCOL_BEGIN_TASK</A>;     public static final String <A HREF="#PROTOCOL_DELIM">PROTOCOL_DELIM</A>;     public static final String <A HREF="#PROTOCOL_END_OUTPUT">PROTOCOL_END_OUTPUT</A>;     public static final String <A HREF="#PROTOCOL_END_TASK">PROTOCOL_END_TASK</A>;     public static final String <A HREF="#PROTOCOL_NEWLINE">PROTOCOL_NEWLINE</A>;     public static final String <A HREF="#PROTOCOL_STOP">PROTOCOL_STOP</A>;     public static final String <A HREF="#TASKS_BETWEEN">TASKS_BETWEEN</A>;     public static final String <A HREF="#TASKS_BETWEEN_PROP">TASKS_BETWEEN_PROP</A>;     protected int <A HREF="#myTaskNumber">myTaskNumber</A>;     protected int <A HREF="#myTaskStatus">myTaskStatus</A>;          // Constructors 1     public <A HREF="#Envoy()">Envoy</A>();          // Methods 20     public static void <A HREF="#main(java.lang.String[])">main</A>(String[]);     protected Authorization <A HREF="#buildAuth()">buildAuth</A>();     public void <A HREF="#explain(java.lang.Throwable)">explain</A>(Throwable);     public int <A HREF="#finish()">finish</A>();     protected Authorization <A HREF="#getAuthorization()">getAuthorization</A>();     protected void <A HREF="#groupTaskArgs(java.util.Enumeration, java.util.Vector, java.lang.String)">groupTaskArgs</A>(Enumeration, Vector, String);     protected Authorization <A HREF="#newAuth()">newAuth</A>();     public void <A HREF="#perform(java.lang.String[])">perform</A>(String[]);     public void <A HREF="#prepare()">prepare</A>();     protected void <A HREF="#prepareTaskIO()">prepareTaskIO</A>();     protected void <A HREF="#protocolBegins()">protocolBegins</A>();     protected void <A HREF="#protocolEnds()">protocolEnds</A>();     protected InputStream <A HREF="#protocolIn()">protocolIn</A>();     protected PrintStream <A HREF="#protocolOut()">protocolOut</A>();     protected void <A HREF="#taskBegins(int, java.lang.String)">taskBegins</A>(int, String);     protected void <A HREF="#taskBeginsOutput(int, app.authkit.envoy.Task)">taskBeginsOutput</A>(int, Task);     protected void <A HREF="#taskEnds(int, app.authkit.envoy.Task, int)">taskEnds</A>(int, Task, int);     protected void <A HREF="#taskEndsOutput(int, app.authkit.envoy.Task)">taskEndsOutput</A>(int, Task);     protected void <A HREF="#taskFails(int, app.authkit.envoy.Task, int)">taskFails</A>(int, Task, int);     protected int <A HREF="#taskPerform(int, java.util.Vector)">taskPerform</A>(int, Vector);}</PRE><P><DL><P>Envoy performs Tasks in a presumably privileged process, reporting on their success.<p> The Envoy.main() method is the typical entry-point of a privileged process, executed via Authorization.execPrivileged(). As a result, its stdin and stdout (System.in and System.out) are presumed to be connected to a pipe going back to the parent process. The pipe's streams may be coupled together, so closing one may close both. This constrains how the Envoy can communicate results back to its parent. The Envoy is expected to return Task outcomes and data on its stdout, including its own termination status, since the privileged Process in the parent may not provide waitFor() or exitValue().<p> An Envoy's stderr stream is typically inherited from the parent process, and usually writes to the system console (or its log-file) in a double-clicked app. It writes to stderr when invoked at the command-line or in other-than-double-clicked launches. It may or may not be used by the Envoy protocol. By default, it is not.<p> The simplest communication protocol for an Envoy is to only return its own "exit status" on stdout, and to discard all output produced by Tasks or external commands. The provided protocol can do more than that, but it's still very simple, if not simple-minded.<h3>Basic Envoy Communication Protocol</h3> The current Envoy communication protocol is brutally simple. It uses the default System I/O streams for its own communications, and sets different streams into System.in, .out, and .err for use by Tasks. It uses the I/O streams as follows:<dl>  <dt>System.in (stdin)</dt>  <dd>Not used.    For Tasks, replaced with an immediate-EOF stream using System.setIn().  </dd>  <dt>System.out (stdout)</dt>  <dd>    Send progress messages and result text back to client (the parent process).    For Tasks, replaced by either an actual stream or a data sink stream,    depending on whether the Task produces output or not.    <b>No Task should close System.out.</b>  </dd>  <dt>System.err (stderr)</dt>  <dd>    Available for diagnostics, such as stack-traces, etc.    This stream is not currently used by the Envoy protocol, though    the default Envoy class will print failure stack-traces on it.    Tasks may freely print() or println() or printStackTrace() to this stream.    <b>No Task should close System.err.</b>  </dd></dl> If a Task produces output that is sent back to the parent process, and the Task closes System.out, it will cause a protocol failure. So don't do that. In the future, a safer stream may be used that doesn't actually close the stream on close(), but only flushes it.<p> As each Task is undertaken, the Envoy sends a task-begin message. As each Task is completed, the Envoy sends a task-end message containing that Task's completion-code.  Between task-begin and task-end, an output-producing Task's output data is produced.  The output data is bracketed by text-begin and text-end messages.<p> When all Tasks are complete, the Envoy sends a stop message containing the Envoy's status code, i.e. its exit-code. An EOF on the Envoy stream before a stop message appears is an indication of failure.<p> The default Envoy behavior is to stop performing Tasks as soon as one of them fails.  That is, as soon as a Task returns a non-zero completion code or throws an uncaught exception.  The appropriate text-end, task-end, and stop messages are sent when a Task fails.<p> All task and stop messages are in plain ASCII text, one byte per char. Each message consists of an LF-terminated line, regardless of the host platform's local line-ending convention. Each message contains multiple parameters separated by :'s.<p><dl>  <dt><b>task-begin:N:classname</b></dt>  <dd>is the task-begin message:    <dl type="compact">    <dt><b>task-begin</b></dt>    <dd>is the literal text "task-begin".</dd>    <dt><b>N</b></dt>    <dd>is a decimal sequence number, the task-number,     starting from 1 and increasing for each task.</dd>    <dt><b>classname</b></dt>    <dd>is the fully qualified classname of the Task about to be    instantiated and performed.</dd>    </dl>    The Task has not yet been loaded or    created when this message is sent.  Therefore, errors arising from Task    instantiation appear as errors belonging to the failing Task, not as    errors between Tasks.    <p>  </dd>  <dt><b>text-begin:N</b></dt>  <dd>is the optional text-begin message:    <dl type="compact">    <dt><b>text-begin</b></dt>    <dd>is the literal text "text-begin".</dd>    <dt><b>N</b></dt>    <dd>is a decimal sequence number matching the current task-number.</dd>    </dl>    The task's output text follows, until a text-end message.    If the task does not produce output, this message is not sent for that task.    <p>  </dd>  <dt><b>text-end:N</b></dt>  <dd>is the optional text-end message:    <dl type="compact">    <dt><b>text-end</b></dt>    <dd>is the literal text "text-end".</dd>    <dt><b>N</b></dt>    <dd>is a decimal sequence number matching the current task-number.</dd>    </dl>    This message is sent even when the task produced no output,     but only if a text-begin message was sent before.    <p>  </dd>  <dt><b>task-end:N:status</b></dt>  <dd>is the task-end message:    <dl type="compact">    <dt><b>task-end</b></dt>    <dd>is the literal text "task-end".</dd>    <dt><b>N</b></dt>    <dd>is a decimal sequence number matching the current task-number.</dd>    <dt><b>status</b></dt>    <dd>is a decimal number, the Task's status code, which is 0 for success, non-0 for failure.</dd>    </dl>    If the task threw an uncaught exception, the status will be -1.    <p>  </dd>  <dt><b>stop:0:status</b></dt>  <dd>is the stop message:    <dl type="compact">    <dt><b>stop</b></dt>    <dd>is the literal text "stop".</dd>    <dt><b>0</b></dt>    <dd>is the apparent task-number, and is always zero.</dd>    <dt><b>status</b></dt>    <dd>is a decimal number, the Envoy's exit code, which is 0 for success, non-0 for failure.</dd>    </dl>    In general, the Envoy's status is 0 when all Tasks perform() successfully.    If the Envoy status is not 0, it is generally the status of the last Task, which presumably failed.    <p>  </dd></dl><p> Subclasses of Envoy can use a different protocol, such as one based on XML. The messages are sent by specific methods, which can be overridden. If you use a different protocol, be sure to change the relevant Tool methods, too. <h3>System Properties Used</h3><dl>  <dt>"file.encoding"</dt>  <dd>implicitly used anywhere a PrintStream is created or parsed,    such as captureUntilEOF(), schlepUntilEOF(), or waitForEnvoy();    or anywhere encoded bytes are turned into a String,    such as translateEnvoyMessage().  </dd>  <dt>"os.name"</dt>  <dd>in <b>buildAuth()</b>    to determine which Authorization class to instantiate.  </dd>  <dt>"envoy.tasks.between"</dt>  <dd>a string value, in <b>perform()</b>    to mark a task-name when parsing Task-groups from the args.  </dd></dl><P></DL><P> <B>See Also:</B><A HREF="../../../app/authkit/envoy/Task.html">Task</A>, <A HREF="../../../app/authkit/envoy/Tool.html">Tool</A>, <A HREF="../../../glguerin/authkit/Authorization.html">Authorization</A><P><BR><BR><BR><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Fields</B></FONT></TD> </TR> </TABLE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="TASKS_BETWEEN"><FONT COLOR="#0000FF">&middot;</FONT> TASKS_BETWEEN</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String TASKS_BETWEEN</PRE><BLOCKQUOTE><P>The default marker between task-groups in the args received by main() and perform().<P><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="TASKS_BETWEEN_PROP"><FONT COLOR="#0000FF">&middot;</FONT> TASKS_BETWEEN_PROP</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String TASKS_BETWEEN_PROP</PRE><BLOCKQUOTE><P>The property name of an override for TASKS_BETWEEN.<P><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="myTaskNumber"><FONT COLOR="#FF00FF">&middot;</FONT> myTaskNumber</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected int myTaskNumber</PRE><BLOCKQUOTE><P>Task-number in perform() etc.<P><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="myTaskStatus"><FONT COLOR="#FF00FF">&middot;</FONT> myTaskStatus</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected int myTaskStatus</PRE><BLOCKQUOTE><P>Completion status of most recently performed Task: 0 = success, !0 = failure-code.<P><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="PROTOCOL_DELIM"><FONT COLOR="#0000FF">&middot;</FONT> PROTOCOL_DELIM</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String PROTOCOL_DELIM</PRE><BLOCKQUOTE><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="PROTOCOL_NEWLINE"><FONT COLOR="#0000FF">&middot;</FONT> PROTOCOL_NEWLINE</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String PROTOCOL_NEWLINE</PRE><BLOCKQUOTE><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="PROTOCOL_BEGIN_TASK"><FONT COLOR="#0000FF">&middot;</FONT> PROTOCOL_BEGIN_TASK</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String PROTOCOL_BEGIN_TASK</PRE><BLOCKQUOTE><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="PROTOCOL_BEGIN_OUTPUT"><FONT COLOR="#0000FF">&middot;</FONT> PROTOCOL_BEGIN_OUTPUT</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String PROTOCOL_BEGIN_OUTPUT</PRE><BLOCKQUOTE><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="PROTOCOL_END_OUTPUT"><FONT COLOR="#0000FF">&middot;</FONT> PROTOCOL_END_OUTPUT</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String PROTOCOL_END_OUTPUT</PRE><BLOCKQUOTE><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="PROTOCOL_END_TASK"><FONT COLOR="#0000FF">&middot;</FONT> PROTOCOL_END_TASK</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String PROTOCOL_END_TASK</PRE><BLOCKQUOTE><P> </BLOCKQUOTE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3> <A NAME="PROTOCOL_STOP"><FONT COLOR="#0000FF">&middot;</FONT> PROTOCOL_STOP</A></H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static final String PROTOCOL_STOP</PRE><BLOCKQUOTE><P> </BLOCKQUOTE><P><BR><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Constructors</B></FONT></TD> </TR> </TABLE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="Envoy"><FONT COLOR="#FFCC00">&middot;</FONT></A><A NAME="Envoy()">Envoy</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public Envoy() </PRE><BLOCKQUOTE><DL><P>Creates, but does not prepare() it.<P></DL></BLOCKQUOTE> <BR><BR><TABLE BGCOLOR="#00ccff" WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD><FONT FACE="arial,helvetica" SIZE=+1><B>&nbsp;&nbsp;Methods</B></FONT></TD> </TR> </TABLE><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="main"><FONT COLOR="#00DD00">&middot;</FONT></A><A NAME="main(java.lang.String[])">main</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public static void main(String[] args) </PRE><BLOCKQUOTE><DL><P>Static entry point, when run as an application. It just creates an Envoy instance and lets it do everything.<p> Normally, this method calls System.exit() with the value returned from finish(). If the Envoy throws an exception, this method calls System.exit(1), after printing a stack-trace to stderr and flushing both output streams.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="explain"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="explain(java.lang.Throwable)">explain</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public void explain(Throwable failure) </PRE><BLOCKQUOTE><DL><P>Emit stack trace on stderr, flushing protocolOut() first.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="prepare"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="prepare()">prepare</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public void prepare() </PRE><BLOCKQUOTE><DL><P>Prepare this Envoy for subsequent use.<p> This method should prepare the System I/O streams for use with Tasks, and arrange to "do protocol" on the default streams, which are presumed to be pipes to a parent process.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="perform"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="perform(java.lang.String[])">perform</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public void perform(String[] args) </PRE><BLOCKQUOTE><DL><P>Work through the args and the Tasks, communicating results to parent using Envoy protocol over presumed pipe. The protocol is performed by taskBegins(), taskEnds(), etc., which are called from taskPerform().<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="finish"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="finish()">finish</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   public int finish() </PRE><BLOCKQUOTE><DL><P>Finish doing protocol and anything else. Return exit-code that will be passed to System.exit().<p> By default, does not release() or detach() the Authorization. Therefore, the default action occurs on process termination, which is equivalent to release().<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="groupTaskArgs"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="groupTaskArgs(java.util.Enumeration, java.util.Vector, java.lang.String)">groupTaskArgs</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void groupTaskArgs(Enumeration argsEnum,                                 Vector taskArgs,                                 String between) </PRE><BLOCKQUOTE><DL><P>Pull one Task-name and a group of args from the given Enumeration, placing the String representation of each into the Vector. Upon return, the Vector may be empty.<p> Task-groups are separated by the 'between' String. The Vector will not contain either a leading or trailing 'between' String.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="taskPerform"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="taskPerform(int, java.util.Vector)">taskPerform</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected int taskPerform(int taskNum,                              Vector taskGroup) </PRE><BLOCKQUOTE><DL><P>Perform a Task and return its status code: 0 for success, non-zero for all others. This method is responsible for all protocol messages regarding the task and its status.<p> This method calls taskBegins() before it runs the Task, followed by taskEnds() or taskFails() afterwards. It also calls taskBeginsOutput() and taskEndsOutput() as appropriate.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="getAuthorization"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="getAuthorization()">getAuthorization</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected <A HREF="../../../glguerin/authkit/Authorization.html">Authorization</A> getAuthorization() </PRE><BLOCKQUOTE><DL><P>Return an Authorization, or null if before prepare()'d.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="buildAuth"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="buildAuth()">buildAuth</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected <A HREF="../../../glguerin/authkit/Authorization.html">Authorization</A> buildAuth() </PRE><BLOCKQUOTE><DL><P>Called from prepare(), build an Authorization for possible subsequent use. If unsuccessful, throw an UnauthorizedException.<p>  The returned Authorization should be attached to a session, if that's appropriate for what the Envoy is doing.  Since an Envoy typically operates with an effective uid of 'root', and is typically a child process via execPrivileged(), the typical attachment is done with attachPrivileged(). This implementation does that.<p> This implementation calls newAuth() to make the concrete Authorization, then calls attachPrivileged() to attach it.  Therefore, an Envoy by default will only run in a child process via execPrivileged(). This is a reasonable precaution to help prevent accidents, such as running Envoy.main() from a normal shell command-line.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="newAuth"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="newAuth()">newAuth</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected <A HREF="../../../glguerin/authkit/Authorization.html">Authorization</A> newAuth() </PRE><BLOCKQUOTE><DL><P>The returned Authorization is unattached to any underlying session. The available concrete imps are hard-wired here, for security reasons.<p> If the "os.name" property is "Mac OS X", then a MacOSXAuthorization is returned. All other situations, including failure to instantiate a MacOSXAuthorization, return a DenyAllAuthorization.<p> The concrete classes are referenced by name, using Class.forName(). This avoids invoking an imp's static initializers unless it's actually chosen.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="protocolIn"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="protocolIn()">protocolIn</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected InputStream protocolIn() </PRE><BLOCKQUOTE><DL><P>Return the stdin InputStream piped from controlling parent process, or null if before prepare()'d.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="protocolOut"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="protocolOut()">protocolOut</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected PrintStream protocolOut() </PRE><BLOCKQUOTE><DL><P>Return the stdout PrintStream piped to controlling parent process, or null if before prepare()'d.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="protocolBegins"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="protocolBegins()">protocolBegins</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void protocolBegins() </PRE><BLOCKQUOTE><DL><P>Set up the streams that will be used to "do protocol" in taskBegins(), tasksEnds(), and taskFails(), and which will be shut down in an orderly fashion by finish().<p> If any initial text should be emitted on the protocol streams, do it here. This ensures it will occur before the first task begins.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="prepareTaskIO"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="prepareTaskIO()">prepareTaskIO</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void prepareTaskIO() </PRE><BLOCKQUOTE><DL><P>Called from prepare(), replace the System I/O streams with ones appropriate for a Task's use. This process's default streams, which are piped to another process, have already been harnessed to "do protocol" by protocolBegins().<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="protocolEnds"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="protocolEnds()">protocolEnds</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void protocolEnds() </PRE><BLOCKQUOTE><DL><P>Called from finish(), send any Envoy-termination messages, and then shut down the I/O streams used to "do protocol". "Shut down" doesn't necessarily mean the streams are closed. It may just mean the streams are flushed, as here.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="taskBegins"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="taskBegins(int, java.lang.String)">taskBegins</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void taskBegins(int taskNum,                              String taskName) </PRE><BLOCKQUOTE><DL><P>Send a BEGIN_TASK protocol message.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="taskBeginsOutput"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="taskBeginsOutput(int, app.authkit.envoy.Task)">taskBeginsOutput</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void taskBeginsOutput(int taskNum,                                    <A HREF="../../../app/authkit/envoy/Task.html">Task</A> task) </PRE><BLOCKQUOTE><DL><P>Send a BEGIN_OUTPUT protocol message, then redirect System.out to a stream ready for the Task to produce its output on. If the Task does not write anything to System.out, then its results will be empty. This is acceptable as far as the protocol is concerned.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="taskEndsOutput"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="taskEndsOutput(int, app.authkit.envoy.Task)">taskEndsOutput</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void taskEndsOutput(int taskNum,                                  <A HREF="../../../app/authkit/envoy/Task.html">Task</A> task) </PRE><BLOCKQUOTE><DL><P>Shut down the System.out used by the Task, sending any protocol messages to mark the end of Task output.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="taskEnds"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="taskEnds(int, app.authkit.envoy.Task, int)">taskEnds</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void taskEnds(int taskNum,                            <A HREF="../../../app/authkit/envoy/Task.html">Task</A> task,                            int status) </PRE><BLOCKQUOTE><DL><P>Send an END_TASK message.<p> The Task should not be null.<P></DL></BLOCKQUOTE> <BR><TABLE WIDTH=100% CELLSPACING=0 CELLPADDING=1 BORDER=0> <TR> <TD WIDTH=80%><BR><H3><A NAME="taskFails"><FONT COLOR="#FF0000">&middot;</FONT></A><A NAME="taskFails(int, app.authkit.envoy.Task, int)">taskFails</A> </H3></TD> <TD ALIGN=right WIDTH=20%> <FONT SIZE="-2"><A HREF="#_Summary_">Summary</A> &nbsp;|&nbsp; <A HREF=#_top_>Top</A></FONT> </TD> </TR> </TABLE><PRE>   protected void taskFails(int taskNum,                             <A HREF="../../../app/authkit/envoy/Task.html">Task</A> task,                             int status) </PRE><BLOCKQUOTE><DL><P>Send an END_TASK message.<p> The Task may be null, so qualify before using it.<P></DL></BLOCKQUOTE> <BR><HR SIZE=1 ALIGN=left WIDTH="98%"><PRE><A HREF="../../../packages.html">All Packages</A>  <A HREF="../../../Package-app/authkit/envoy.html">This Package</A>  <A HREF="../../../tree.html">Class Hierarchy</A>  <A HREF="../../../Search.html">Class Search</A>  <A HREF="../../../AllNames.html">Index</A></PRE><FONT FACE="Arial,Helvetica" SIZE=-2>Freshly brewed Java API Documentation automatically generated with <A HREF="http://www.ualberta.ca/~tgee/polardoc">polardoc</A> Version 1.0.7<BR></FONT></BODY></HTML>